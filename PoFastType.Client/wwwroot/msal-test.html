<!DOCTYPE html>
<html>
<head>
    <title>MSAL Test</title>
    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
</head>
<body>
    <h1>Azure B2C MSAL Test</h1>
    <button id="loginButton">Sign In</button>
    <button id="logoutButton" style="display:none;">Sign Out</button>
    <div id="userInfo"></div>

    <script>
        const msalConfig = {
            auth: {
                clientId: '73e6779c-2df7-4f3e-a9ae-077db8ea9a6d',
                authority: 'https://login.microsoftonline.com/common/v2.0',
                redirectUri: 'http://localhost:5000/msal-test.html'
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const userInfo = document.getElementById('userInfo');

        loginButton.addEventListener('click', async () => {
            try {
                const loginResponse = await msalInstance.loginPopup({
                    scopes: ['openid', 'profile', 'email']
                });
                console.log('Login successful', loginResponse);
                showUserInfo(loginResponse.account);
            } catch (error) {
                console.error('Login failed', error);
                userInfo.innerHTML = `<p style="color: red;">Login failed: ${error.message}</p>`;
            }
        });

        logoutButton.addEventListener('click', async () => {
            try {
                await msalInstance.logoutPopup();
                userInfo.innerHTML = '';
                loginButton.style.display = 'inline';
                logoutButton.style.display = 'none';
            } catch (error) {
                console.error('Logout failed', error);
            }
        });

        function showUserInfo(account) {
            userInfo.innerHTML = `
                <h3>User Information:</h3>
                <p><strong>Name:</strong> ${account.name}</p>
                <p><strong>Username:</strong> ${account.username}</p>
                <p><strong>ID:</strong> ${account.homeAccountId}</p>
            `;
            loginButton.style.display = 'none';
            logoutButton.style.display = 'inline';
        }

        // Check if user is already logged in
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length > 0) {
            showUserInfo(accounts[0]);
        }
    </script>
</body>
</html>
