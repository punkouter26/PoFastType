<!DOCTYPE html>
<html>
<head>
    <title>PoFastType Auth Test</title>
    <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
</head>
<body>
    <h1>Microsoft Authentication Test</h1>
    <button id="signInButton">Sign in with Microsoft</button>
    <button id="signOutButton" style="display:none;">Sign out</button>
    <div id="userInfo"></div>

    <script>
        // MSAL configuration - matches your PoFastType settings
        const msalConfig = {
            auth: {
                clientId: '5eaad8fd-fdba-4bd9-8209-2e22ea3e5f3a',
                authority: 'https://login.microsoftonline.com/5da66fe6-bd58-4517-8727-deebc8525dcb',
                redirectUri: 'http://localhost:5000/authentication/login-callback'
            },
            cache: {
                cacheLocation: 'localStorage',
                storeAuthStateInCookie: false
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        const loginRequest = {
            scopes: ['openid', 'profile', 'email']
        };

        // Sign in function
        async function signIn() {
            try {
                console.log('Starting sign-in...');
                const response = await msalInstance.loginPopup(loginRequest);
                console.log('Sign-in successful:', response);
                
                // Update UI
                document.getElementById('signInButton').style.display = 'none';
                document.getElementById('signOutButton').style.display = 'block';
                document.getElementById('userInfo').innerHTML = `
                    <h3>Welcome, ${response.account.name}!</h3>
                    <p>Email: ${response.account.username}</p>
                    <p>Tenant: ${response.account.tenantId}</p>
                `;
            } catch (error) {
                console.error('Sign-in failed:', error);
                document.getElementById('userInfo').innerHTML = `
                    <p style="color: red;">Sign-in failed: ${error.message}</p>
                `;
            }
        }

        // Sign out function
        async function signOut() {
            try {
                await msalInstance.logoutPopup();
                document.getElementById('signInButton').style.display = 'block';
                document.getElementById('signOutButton').style.display = 'none';
                document.getElementById('userInfo').innerHTML = '';
            } catch (error) {
                console.error('Sign-out failed:', error);
            }
        }

        // Event listeners
        document.getElementById('signInButton').addEventListener('click', signIn);
        document.getElementById('signOutButton').addEventListener('click', signOut);

        // Check if user is already signed in
        msalInstance.initialize().then(() => {
            const accounts = msalInstance.getAllAccounts();
            if (accounts.length > 0) {
                console.log('User already signed in:', accounts[0]);
                document.getElementById('signInButton').style.display = 'none';
                document.getElementById('signOutButton').style.display = 'block';
                document.getElementById('userInfo').innerHTML = `
                    <h3>Welcome back, ${accounts[0].name}!</h3>
                    <p>Email: ${accounts[0].username}</p>
                `;
            }
        });
    </script>
</body>
</html>
