<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <location path="." inheritInChildApplications="false">
    <system.webServer>
      <handlers>
        <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
      </handlers>
      <aspNetCore processPath="dotnet" arguments=".\PoFastType.Api.dll" stdoutLogEnabled="false" stdoutLogFile=".\logs\stdout" hostingModel="inprocess" />
      
      <!-- Static file handling for Blazor WebAssembly -->
      <staticContent>
        <remove fileExtension=".wasm" />
        <mimeMap fileExtension=".wasm" mimeType="application/wasm" />
        <remove fileExtension=".br" />
        <mimeMap fileExtension=".br" mimeType="application/octet-stream" />
        <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="1.00:00:00" />
      </staticContent>
      
      <!-- URL Rewrite rules for Blazor WebAssembly routing -->
      <rewrite>
        <rules>
          <!-- Serve static files directly -->
          <rule name="StaticFiles" stopProcessing="true">
            <match url="^(css|js|lib|_framework|_content)\/.*" />
            <action type="Rewrite" url="{R:0}" />
          </rule>
          
          <!-- Handle API routes -->
          <rule name="ApiRoutes" stopProcessing="true">
            <match url="^api\/.*" />
            <action type="Rewrite" url="{R:0}" />
          </rule>
          
          <!-- Fallback to index.html for SPA routing -->
          <rule name="SpaFallback" stopProcessing="true">
            <match url=".*" />
            <conditions logicalGrouping="MatchAll">
              <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
              <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
            </conditions>
            <action type="Rewrite" url="/" />
          </rule>
        </rules>
      </rewrite>
    </system.webServer>
  </location>
</configuration>
